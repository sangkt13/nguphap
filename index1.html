<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>IELTS Grammar Master</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#4F46E5',   // Indigo 600
            secondary: '#10B981', // Emerald 500
            accent: '#F59E0B',    // Amber 500
          },
          fontFamily: {
            sans: ['Inter', 'sans-serif'],
          }
        }
      }
    }
  </script>

  <style>
    body { font-family: 'Inter', sans-serif; background-color: #F3F4F6; }

    /* Custom Animations */
    .fade-in { animation: fadeIn 0.5s ease-in-out; }
    .slide-up { animation: slideUp 0.4s ease-out; }

    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

    .glass-panel {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .tab-active { border-bottom: 2px solid #4F46E5; color: #4F46E5; font-weight: 600; }
    .tab-inactive { color: #6B7280; border-bottom: 2px solid transparent; }
    .tab-inactive:hover { color: #374151; }
  </style>
</head>

<body class="text-gray-800 flex flex-col min-h-screen">

  <!-- Navbar -->
  <nav class="bg-white shadow-sm sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between h-16">
        <div class="flex">
          <div class="flex-shrink-0 flex items-center cursor-pointer" onclick="app.goHome()">
            <div class="bg-primary text-white p-2 rounded-lg font-bold text-xl mr-2">IG</div>
            <span class="font-bold text-xl text-gray-900 tracking-tight">
              IELTS Grammar<span class="text-primary">Lite</span>
            </span>
          </div>
        </div>

        <div class="hidden md:flex space-x-8 items-center">
          <a href="#" onclick="app.goHome()" class="text-gray-900 hover:text-primary transition px-3 py-2 rounded-md font-medium">Trang ch·ªß</a>
          <a href="#" class="text-gray-500 hover:text-primary transition px-3 py-2 rounded-md font-medium">L·ªô tr√¨nh</a>
          <a href="#" class="text-gray-500 hover:text-primary transition px-3 py-2 rounded-md font-medium">Th·ªëng k√™</a>
          <button class="bg-primary text-white px-4 py-2 rounded-full shadow hover:bg-indigo-700 transition">
            ƒêƒÉng nh·∫≠p
          </button>
        </div>
      </div>
    </div>
  </nav>

  <!-- Main Content Area -->
  <main id="app-container" class="flex-grow max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 w-full">
    <!-- Dynamic Content Injected Here -->
  </main>

  <!-- Footer -->
  <footer class="bg-white border-t mt-auto">
    <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
      <p class="text-center text-gray-500 text-sm">¬© 2023 IELTS GrammarLite. Designed for efficient learning.</p>
    </div>
  </footer>

  <!-- JavaScript Logic -->
  <script>
    // =========================
    // DATA STORE
    // =========================
    const topics = [
      {
        id: 1,
        title: "Th√¨ Hi·ªán T·∫°i Ho√†n Th√†nh (Present Perfect)",
        level: "IELTS Band 4.0 - 5.0",
        icon: "‚è≥",
        color: "bg-blue-100 text-blue-600",
        desc: "D√πng ƒë·ªÉ m√¥ t·∫£ tr·∫£i nghi·ªám ho·∫∑c h√†nh ƒë·ªông v·ª´a m·ªõi x·∫£y ra.",
        theory: {
          summary: "Subject + have/has + V3/ed",
          points: [
            "<strong>C√°ch d√πng 1:</strong> H√†nh ƒë·ªông b·∫Øt ƒë·∫ßu trong qu√° kh·ª© v√† k√©o d√†i ƒë·∫øn hi·ªán t·∫°i.",
            "<strong>C√°ch d√πng 2:</strong> H√†nh ƒë·ªông x·∫£y ra trong qu√° kh·ª© kh√¥ng r√µ th·ªùi gian.",
            "<strong>C√°ch d√πng 3:</strong> H√†nh ƒë·ªông v·ª´a m·ªõi x·∫£y ra (d√πng v·ªõi 'just')."
          ],
          example: "I <strong>have lived</strong> in Hanoi for 5 years.",
          tip: "üîë M·∫πo nh·ªõ: Th·∫•y 'since', 'for', 'just', 'already', 'yet' -> Nghƒ© ngay ƒë·∫øn th√¨ n√†y!"
        },
        quiz: [
          {
            question: "I ______ my homework yet.",
            options: ["have finished", "haven't finished", "didn't finish", "not finish"],
            correct: 1
          },
          {
            question: "She ______ in London since 2010.",
            options: ["lived", "has lived", "lives", "living"],
            correct: 1
          }
        ]
      },
      {
        id: 2,
        title: "C√¢u B·ªã ƒê·ªông (Passive Voice)",
        level: "IELTS Band 5.5 - 6.5",
        icon: "üîÑ",
        color: "bg-purple-100 text-purple-600",
        desc: "Nh·∫•n m·∫°nh v√†o h√†nh ƒë·ªông ho·∫∑c ƒë·ªëi t∆∞·ª£ng ch·ªãu t√°c ƒë·ªông.",
        theory: {
          summary: "Be + Past Participle (V3/ed)",
          points: [
            "<strong>C·∫•u tr√∫c:</strong> Object + be + V3 + (by Subject).",
            "<strong>Hi·ªán t·∫°i ƒë∆°n:</strong> am/is/are + V3.",
            "<strong>Qu√° kh·ª© ƒë∆°n:</strong> was/were + V3."
          ],
          example: "The report <strong>was written</strong> by John.",
          tip: "üîë M·∫πo nh·ªõ: Trong Writing Task 1 (Process), B·ªã ƒë·ªông l√† VUA. Lu√¥n d√πng khi mi√™u t·∫£ quy tr√¨nh s·∫£n xu·∫•t."
        },
        quiz: [
          {
            question: "The house ______ by fire.",
            options: ["destroy", "was destroyed", "destroyed", "destroying"],
            correct: 1
          },
          {
            question: "A new bridge ______ built across the river right now.",
            options: ["is", "is being", "was", "has been"],
            correct: 1
          }
        ]
      },
      {
        id: 3,
        title: "M·ªánh ƒê·ªÅ Quan H·ªá (Relative Clauses)",
        level: "IELTS Band 6.0+",
        icon: "üîó",
        color: "bg-green-100 text-green-600",
        desc: "N·ªëi c√°c c√¢u l·∫°i v·ªõi nhau ƒë·ªÉ c√¢u vƒÉn ph·ª©c t·∫°p v√† hay h∆°n.",
        theory: {
          summary: "Who / Which / That / Whose",
          points: [
            "<strong>Who:</strong> Thay th·∫ø cho ng∆∞·ªùi.",
            "<strong>Which:</strong> Thay th·∫ø cho v·∫≠t.",
            "<strong>That:</strong> D√πng cho c·∫£ hai (trong m·ªánh ƒë·ªÅ x√°c ƒë·ªãnh)."
          ],
          example: "The man <strong>who</strong> spoke to you is my teacher.",
          tip: "üîë M·∫πo nh·ªõ: D√πng m·ªánh ƒë·ªÅ quan h·ªá gi√∫p tƒÉng ƒëi·ªÉm Grammatical Range trong Speaking v√† Writing."
        },
        quiz: [
          {
            question: "This is the book ______ I bought yesterday.",
            options: ["who", "where", "which", "whose"],
            correct: 2
          },
          {
            question: "Do you know the girl ______ mother is a famous singer?",
            options: ["who", "whom", "whose", "that"],
            correct: 2
          }
        ]
      }
    ];

    // =========================
    // APP LOGIC
    // =========================
    const app = {
      container: document.getElementById('app-container'),

      init: function () {
        this.renderHome();
      },

      goHome: function () {
        this.renderHome();
      },

      renderHome: function () {
        let html = `
          <div class="text-center mb-12 fade-in">
            <h1 class="text-4xl md:text-5xl font-extrabold text-gray-900 mb-4">
              Chinh ph·ª•c <span class="text-transparent bg-clip-text bg-gradient-to-r from-primary to-purple-600">Ng·ªØ ph√°p IELTS</span>
            </h1>
            <p class="text-lg text-gray-600 max-w-2xl mx-auto">
              L√Ω thuy·∫øt tinh g·ªçn, d·ªÖ nh·ªõ k√®m b√†i t·∫≠p th·ª±c h√†nh s√°t s∆∞·ªùn. H·ªçc l√† hi·ªÉu, hi·ªÉu l√† d√πng ƒë∆∞·ª£c ngay.
            </p>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 slide-up">
        `;

        topics.forEach(topic => {
          html += `
            <div class="bg-white rounded-xl shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-1 cursor-pointer overflow-hidden border border-gray-100"
                 onclick="app.loadTopic(${topic.id})">
              <div class="p-6">
                <div class="flex justify-between items-start mb-4">
                  <div class="${topic.color} w-12 h-12 rounded-full flex items-center justify-center text-2xl">
                    ${topic.icon}
                  </div>
                  <span class="text-xs font-bold uppercase tracking-wide bg-gray-100 text-gray-600 px-2 py-1 rounded">${topic.level}</span>
                </div>
                <h3 class="text-xl font-bold text-gray-900 mb-2">${topic.title}</h3>
                <p class="text-gray-500 text-sm mb-4">${topic.desc}</p>
                <div class="w-full bg-gray-50 text-primary text-center py-2 rounded-lg font-medium hover:bg-primary hover:text-white transition">
                  B·∫Øt ƒë·∫ßu h·ªçc ‚Üí
                </div>
              </div>
            </div>
          `;
        });

        html += `</div>`;
        this.container.innerHTML = html;
      },

      loadTopic: function (id) {
        const topic = topics.find(t => t.id === id);
        if (!topic) return;

        const html = `
          <div class="fade-in">
            <button onclick="app.goHome()" class="mb-6 flex items-center text-gray-500 hover:text-primary transition">
              <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
              </svg>
              Quay l·∫°i danh s√°ch
            </button>

            <div class="bg-white rounded-2xl shadow-xl overflow-hidden min-h-[500px]">
              <div class="md:flex h-full">
                <!-- Sidebar -->
                <div class="md:w-1/3 bg-gray-50 p-6 border-r border-gray-100">
                  <h2 class="text-2xl font-bold text-gray-900 mb-2">${topic.title}</h2>
                  <p class="text-gray-500 text-sm mb-6">${topic.desc}</p>

                  <div class="space-y-2">
                    <button id="btn-theory" onclick="app.switchTab('theory', ${topic.id})"
                      class="w-full text-left px-4 py-3 rounded-lg font-medium bg-white shadow-sm border border-gray-200 text-primary">
                      üìñ L√Ω thuy·∫øt c·ªët l√µi
                    </button>

                    <button id="btn-practice" onclick="app.switchTab('practice', ${topic.id})"
                      class="w-full text-left px-4 py-3 rounded-lg font-medium text-gray-600 hover:bg-white hover:shadow-sm transition">
                      ‚úçÔ∏è B√†i t·∫≠p th·ª±c h√†nh
                    </button>
                  </div>
                </div>

                <!-- Content Area -->
                <div class="md:w-2/3 p-8" id="content-area">
                  <!-- Injected -->
                </div>
              </div>
            </div>
          </div>
        `;

        this.container.innerHTML = html;
        this.switchTab('theory', id);
      },

      switchTab: function (tabName, topicId) {
        const topic = topics.find(t => t.id === topicId);
        const contentArea = document.getElementById('content-area');
        const btnTheory = document.getElementById('btn-theory');
        const btnPractice = document.getElementById('btn-practice');

        if (tabName === 'theory') {
          btnTheory.className = "w-full text-left px-4 py-3 rounded-lg font-medium bg-white shadow-sm border border-gray-200 text-primary ring-1 ring-primary/20";
          btnPractice.className = "w-full text-left px-4 py-3 rounded-lg font-medium text-gray-600 hover:bg-white hover:shadow-sm transition";

          contentArea.innerHTML = `
            <div class="fade-in space-y-6">
              <div class="bg-indigo-50 border-l-4 border-primary p-4 rounded-r-lg">
                <h3 class="text-lg font-bold text-primary mb-1">C√¥ng th·ª©c chung</h3>
                <p class="text-2xl font-mono text-gray-800">${topic.theory.summary}</p>
              </div>

              <div>
                <h3 class="text-xl font-bold text-gray-900 mb-3">C√°ch s·ª≠ d·ª•ng</h3>
                <ul class="list-disc list-inside space-y-2 text-gray-700 leading-relaxed">
                  ${topic.theory.points.map(point => `<li>${point}</li>`).join('')}
                </ul>
              </div>

              <div class="bg-gray-100 p-4 rounded-lg">
                <h3 class="font-bold text-gray-900">V√≠ d·ª• minh h·ªça:</h3>
                <p class="text-gray-700 italic mt-1">"${topic.theory.example}"</p>
              </div>

              <div class="bg-yellow-50 border border-yellow-200 p-4 rounded-lg flex items-start">
                <span class="text-2xl mr-3">üí°</span>
                <p class="text-yellow-800 text-sm pt-1">${topic.theory.tip}</p>
              </div>
            </div>
          `;
        } else {
          btnPractice.className = "w-full text-left px-4 py-3 rounded-lg font-medium bg-white shadow-sm border border-gray-200 text-secondary ring-1 ring-secondary/20";
          btnTheory.className = "w-full text-left px-4 py-3 rounded-lg font-medium text-gray-600 hover:bg-white hover:shadow-sm transition";

          let quizHtml = `
            <div class="fade-in">
              <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3 mb-6">
                <h3 class="text-xl font-bold text-gray-900">B√†i t·∫≠p v·∫≠n d·ª•ng</h3>

                <button type="button"
                  onclick="app.generateAIQuiz(${topic.id})"
                  class="bg-primary hover:bg-indigo-700 text-white font-bold py-2.5 px-5 rounded-lg transition shadow">
                  ‚ú® T·∫°o b√†i t·∫≠p b·∫±ng AI
                </button>
              </div>

              <div id="ai-status" class="hidden mb-4 p-3 rounded-lg text-sm"></div>

              <form id="quiz-form">
          `;

          topic.quiz.forEach((q, index) => {
            quizHtml += `
              <div class="mb-6 p-4 border rounded-lg bg-gray-50">
                <p class="font-semibold text-gray-800 mb-3">C√¢u ${index + 1}: ${q.question}</p>
                <div class="space-y-2">
            `;

            q.options.forEach((opt, optIndex) => {
              quizHtml += `
                <label class="flex items-center space-x-3 cursor-pointer p-2 rounded hover:bg-white transition">
                  <input type="radio" name="q${index}" value="${optIndex}" class="form-radio text-primary h-4 w-4">
                  <span class="text-gray-700">${opt}</span>
                </label>
              `;
            });

            quizHtml += `</div></div>`;
          });

          quizHtml += `
              <div id="result-area" class="hidden mb-4 p-4 rounded-lg"></div>

              <button type="button" onclick="app.checkAnswers(${topic.id})"
                class="w-full md:w-auto bg-secondary hover:bg-emerald-600 text-white font-bold py-3 px-8 rounded-lg transition shadow-lg transform hover:scale-105">
                Ki·ªÉm tra ƒë√°p √°n
              </button>
            </form>
          </div>
          `;

          contentArea.innerHTML = quizHtml;
        }
      },

      checkAnswers: function (topicId) {
        const topic = topics.find(t => t.id === topicId);
        let score = 0;
        const total = topic.quiz.length;
        const form = document.getElementById('quiz-form');

        topic.quiz.forEach((q, index) => {
          const selected = form.querySelector(`input[name="q${index}"]:checked`);
          const container = form.querySelectorAll('.mb-6')[index];

          // reset
          container.classList.remove('bg-green-50', 'bg-red-50', 'border-green-300', 'border-red-300');
          const icon = container.querySelector('.result-icon');
          if (icon) icon.remove();

          if (selected && parseInt(selected.value) === q.correct) {
            score++;
            container.classList.add('bg-green-50', 'border-green-300', 'border');
            container.insertAdjacentHTML('beforeend', '<p class="text-green-600 font-bold mt-2 text-sm result-icon">‚úì Ch√≠nh x√°c</p>');
          } else {
            container.classList.add('bg-red-50', 'border-red-300', 'border');
            container.insertAdjacentHTML('beforeend', `<p class="text-red-500 font-bold mt-2 text-sm result-icon">‚úó Sai r·ªìi. ƒê√°p √°n ƒë√∫ng: ${q.options[q.correct]}</p>`);
          }
        });

        const resultArea = document.getElementById('result-area');
        resultArea.classList.remove('hidden', 'bg-green-100', 'text-green-800', 'bg-yellow-100', 'text-yellow-800');

        if (score === total) {
          resultArea.classList.add('bg-green-100', 'text-green-800');
          resultArea.innerHTML = `<strong>Tuy·ªát v·ªùi!</strong> B·∫°n ƒë√£ tr·∫£ l·ªùi ƒë√∫ng ${score}/${total} c√¢u.`;
        } else {
          resultArea.classList.add('bg-yellow-100', 'text-yellow-800');
          resultArea.innerHTML = `<strong>C·ªë l√™n!</strong> B·∫°n ƒë√£ ƒë√∫ng ${score}/${total} c√¢u. H√£y xem l·∫°i l√Ω thuy·∫øt nh√©.`;
        }
      },

      // =========================
      // AI: Generate quiz via Vercel Function (/api/generate-quiz)
      // =========================
      generateAIQuiz: async function (topicId) {
        const topic = topics.find(t => t.id === topicId);
        const status = document.getElementById('ai-status');

        const setStatus = (type, msg) => {
          status.classList.remove(
            'hidden',
            'bg-yellow-100', 'text-yellow-800',
            'bg-red-100', 'text-red-800',
            'bg-green-100', 'text-green-800'
          );
          if (type === 'loading') status.classList.add('bg-yellow-100', 'text-yellow-800');
          if (type === 'error') status.classList.add('bg-red-100', 'text-red-800');
          if (type === 'success') status.classList.add('bg-green-100', 'text-green-800');
          status.innerHTML = msg;
        };

        try {
          setStatus('loading', '‚è≥ ƒêang t·∫°o b√†i t·∫≠p b·∫±ng AI...');

          const res = await fetch('/api/generate-quiz', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              topicTitle: topic.title,
              level: topic.level,
              theorySummary: topic.theory.summary,
              points: topic.theory.points,
              numQuestions: 5
            })
          });

          if (!res.ok) {
            const errText = await res.text();
            throw new Error(errText || `HTTP ${res.status}`);
          }

          const data = await res.json();

          if (!data?.quiz?.length) {
            throw new Error('AI kh√¥ng tr·∫£ v·ªÅ quiz h·ª£p l·ªá.');
          }

          // Replace quiz
          topic.quiz = data.quiz;

          // Re-render practice tab
          this.switchTab('practice', topicId);

          // Show success
          const newStatus = document.getElementById('ai-status');
          if (newStatus) {
            newStatus.classList.remove('hidden');
            newStatus.classList.add('bg-green-100', 'text-green-800');
            newStatus.innerHTML = `‚úÖ ƒê√£ t·∫°o ${data.quiz.length} c√¢u m·ªõi cho: <strong>${topic.title}</strong>`;
          }

        } catch (e) {
          setStatus('error', `‚ùå L·ªói t·∫°o b√†i t·∫≠p AI: ${e.message}`);
        }
      }
    };

    // Initialize App
    document.addEventListener('DOMContentLoaded', () => {
      app.init();
    });
  </script>
</body>
</html>
